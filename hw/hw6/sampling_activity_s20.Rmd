---
title: "Straws-Sample-Confidence-Intervals"
author: "Jose Rico"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    toc: true
    toc_float : true
    theme: cosmo
    highlight: tango
---

```{r, include=F, message=FALSE}
library(readr)
library(tidyverse)
library(janitor)
library(infer)
library(kableExtra)
library(gridExtra)
```

```{r loading data, message = F, error=FALSE, include=F}
straws <- read_csv("straws.csv", col_types = cols(X1 = col_skip()))
straws <- straws %>% 
  mutate(blue = ifelse(straws$color=="blue",1,0))
p_blue_population = mean(straws$blue)
```

# Background
For this activity, you will be exploring sampling using R.  We will be sampling a population of 2500 virtual straws from the dataframe `straws`.  `straws` is a dataframe of 2500 virtual straws of six colors (blue, green, orange, purple, red and yellow). Below is a visualization of the virtual 2500 straws.  Our parameter (of the population) of interest is **What is the proportion of blue straws in our population?**

```{r, echo=F}
ggplot(straws, aes(x_pos,y_pos, fill=color, color=color))+
  geom_raster(interpolate=F)+
  
  scale_colour_manual(values = c("blue","green" ,"orange", "purple", "red", "yellow"), aesthetics = c("colour", "fill"))+
  
  scale_x_continuous(limits=c(0,50))+
  scale_y_continuous(limits=c(0,50))+
  
  ggtitle("Visualization of our Population of 2500 straws")+
  
  theme(legend.position = "none",
        panel.grid = element_blank(),
        axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank()) 
```

# Data Frame Details

Our `straws` dataframe has 2 variables of interest  

  - **color** - color of the individual straw
  - **blue** - binary variable (**1** if the straw is blue, **0** is the straw is not blue)

A sample of 5 rows in `straws` dataframe  
(note: **x_pos** and **y_pos** are variables used to create the tiling visualization with `geom_raster`)  
```{r, echo=FALSE}
sample_n(straws, 5) %>% 
  kable() %>% 
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

# Sampling

We can take a single sample of straws in R, using the `sample_n` function in R.  The `sample_n` function has two parameters of interest for us.  

* The `size = 50` argument defines how many rows to sample from the `straws` dataframe.  
* The `replace = F` argument, tells R to keep selecting rows without replacing selections.  
  + This means that once a row is selected it can not be re-selected, this is called **sampling without replacement**.  

After taking the sample, we create a quick tabulation of our `sample1`'s **color** variable.

```{r}
sample1 <- straws %>% 
  sample_n(size = 50, replace = F )

sample1 %>% tabyl(color)
```

### **Prompt 1** - Do you think the percent of blue straws that you just obtained is the actual percent for the proportion of blue straws?  Why or why not?  Is it close?  How close?

> **your answer goes here**

### **Prompt 2** - How could improve your insight into the proportion of blue straws?

> **your answer goes here**


# Sampling Distribution

In order to better understand the variability in random samples, it is useful to simulate multiple random samples from the same population.  After obtaining multiple samples, we will create a visualization (histogram) displaying the results of all the random samples.  Then we will analyze the histogram which describes the distribution of simulation.

## Simulating Multiple Random Samples
In order to simulate multiple random samples, we will use the `rep_sample_n` from the `infer` package. The `rep_sample_n` function has two parameters of interest for us.  We will sample from `straws` and put the samples into a new dataframe `samples_n50_reps1000`. 

* The `reps = 1000`argument defines how many samples to collect.
* The `size = 50` argument defines how many rows to sample from the `straws` dataframe.  
* The `replace = F` argument, tells R to keep selecting rows without replacing selections.


```{r}
samples_n50_reps1000 <- straws %>%
        rep_sample_n(size = 50, reps = 1000, replace = F)
```

### **Prompt 3** - How does `samples_n50_reps1000` differ from `straws` ?

> **your answer goes here**

## Summarizing our Samples
We are interested in the proportion of blue straws in each sample, so we need to instruct R to calculate the sample proportion for each individual sample of 50.  
Then we create use the `summarize` command to caculate the proportion of blue straws for each of the 1000 random sample of 50 straws.

```{r}
summary_n50_reps1000 <- samples_n50_reps1000 %>% 
          summarize(p_hat = mean(blue))
```

### **Prompt 4** - How does `summary_n50_reps1000` differ from `samples_n50_reps1000`  ?

> **your answer goes here**

## Visualization

## Visualization the color composition of our samples 
```{r}
samples_n50_reps1000 %>% 
  ggplot(aes(fill=color, x=replicate))+
    geom_bar(position = position_fill(reverse = T), width=0.6) +
    scale_y_continuous(labels=percent) +
    xlim(0,100)+
    scale_colour_manual(values = c("blue","green" ,"orange", "purple", "red", "yellow"), aesthetics = c("colour", "fill"))+
    coord_flip()
```

## Visualizing the Distribution of 
Now, we will visualize the 1000 random samples' proportion of blue straws.

```{r}
summary_n50_reps1000 %>% 
  
  ggplot() +
  
  geom_histogram(aes(p_hat*100), 
                 binwidth = 2, 
                 color="white", 
                 fill="steelblue") +
  
  labs(x = "Sample Proportion of Blue Straws (Percent)",
       title ="Sampling Distribution of p_hat based on sample size, n, of 50")
```


# Next HW 6 - The Confidence Interval and Confidence Level
```{r}
#### additional code to use in the confidence interval homework #####
#### also need to calculate actual p_blue of straws ####
#### this is probably the last step we show - need student to first observe SE, Creation of Bounds for Single CI ####

samples_n50_reps20 <- straws %>%
        rep_sample_n(size = 50, reps = 20, replace = F)

ci_n50_reps20 <-  samples_n50_reps20 %>%
  
        summarise(p_hat = mean(blue), 
                  se = sqrt(p_hat*(1-p_hat)/50),  ### need to modify for proper sample size
                  me = qnorm(0.95) * se,
                  lower = p_hat - me,
                  upper = p_hat + me)

ci_n50_reps20 <- ci_n50_reps20 %>%
  mutate(capture_p = ifelse(lower < p_blue_population & upper > p_blue_population, "yes", "no"))

ci_n50_reps20_data <- gather(ci_n50_reps20, type, bound, lower:upper)

ci_n50_reps20_data %>% 

  ggplot(aes(y = replicate, x = bound, group = replicate, color=capture_p)) +
    geom_point(size = 2)+
    geom_line(color="forestgreen")+
    geom_vline(xintercept = 0.1904, color = "steelblue")+
    scale_x_continuous(limits = c(0.00, 0.50))+
    theme(legend.position = "none")

```






























