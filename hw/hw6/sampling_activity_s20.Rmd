---
title: "Straws-Sample-Confidence-Intervals"
author: "Jose Rico"
date: "March 22, 2020"
output: 
  html_document:
    toc: true
    theme: cosmo
    highlight: tango
---

```{r, include=F, message=FALSE}
library(readr)
library(tidyverse)
library(janitor)
library(infer)
library(gridExtra)
```

```{r loading data, message = F, error=FALSE, include=F}
straws <- read_csv("straws.csv", col_types = cols(X1 = col_skip()))
straws <- straws %>% 
  mutate(blue = ifelse(straws$color=="blue",1,0))
p_blue_population = mean(straws$blue)
```

# Background
For this activity, you will be exploring sampling using R.  We will be sampling a population of 2500 virtual straws from the dataframe `straws`.  `straws` is a dataframe of 2500 virtual straws of six colors (blue, green, orange, purple, red and yellow). Below is a visualization of the virtual 2500 straws.

```{r, echo=F}
ggplot(straws, aes(x_pos,y_pos, fill=color, color=color))+
  geom_raster(interpolate=F)+
  
  scale_colour_manual(values = c("blue","green" ,"orange", "purple", "red", "yellow"), aesthetics = c("colour", "fill"))+
  
  scale_x_continuous(limits=c(0,50))+
  scale_y_continuous(limits=c(0,50))+
  
  ggtitle("Visualization of our Population of 2500 straws")+
  
  theme(legend.position = "none",
        panel.grid = element_blank(),
        axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank()) 
```

# Data Frame Details

Our `straws` dataframe has 2 variables of interest  

  - **color** - color of the individual straw
  - **blue** - binary variable (**1** if the straw is blue, **0** is the straw is not blue)


# Sampling

We can take a single sample of straws in R, using the `sample_n` function in R.  The `sample_n` function has two parameters of interest for us.  

  - The `size = 50` defines how many rows to sample from the `straws` dataframe.  
  - The `replace = F`, tells R to keep selecting rows without replacing selections.  
  
    - This means that once a row is selected it can not be re-selected, this is called **sampling without replacement**.  

After taking the sample, we create a quick tabulation of our `sample1`'s **color** variable.

```{r}
sample1 <- straws %>% 
  sample_n(size = 50, replace = F )

sample1 %>% tabyl(color)
```

## **Prompt 1** - Do you think the percent of blue straws that you just obtained is the actual percent for the proportion of blue straws?  Why or why not?

  - <**your answer goes here**>

## **Prompt 2** - How could improve your insight into the proportion of blue straws?

  - <**your answer goes here**>


## Sampling Distribution

In order to better understand the variability in random samples, it is useful to simulate multiple random samples from the same population.  After obtaining multiple samples, we will create a visualization (histogram) displaying the results of all the random samples.  Then we will analyze the simulation.

In order to simulate multiple random samples, we will use the `rep_sample_n` from the `infer` package.  

```{r}
samples_n50_reps1000 <- straws %>%
        rep_sample_n(size = 50, reps = 1000, replace = F)
```

Then we create use the `summarize` command to caculate the proportion of blue straws for each of the 20 random sample of 50 straws.

```{r}
summary_n50_reps1000 <- samples_n50_reps1000 %>% 
          summarise(p_hat = mean(blue))
```

Now, we will visualize the 1000 random samples' proportion of blue straws.

```{r}
summary_n50_reps1000 %>% 
  
  ggplot() +
  
  geom_histogram(aes(p_hat*100), 
                 binwidth = 2, 
                 color="white", 
                 fill="steelblue") +
  
  labs(x = "Sample Proportion of Blue Straws (Percent)",
       title ="Sampling Distribution of p_hat based on sample size, n, of 50")
```


# Next HW 6 - The Confidence Interval and Confidence Level
```{r}
#### additional code to use in the confidence interval homework #####
#### also need to calculate actual p_blue of straws ####
#### this is probably the last step we show - need student to first observe SE, Creation of Bounds for Single CI ####

samples_n50_reps20 <- straws %>%
        rep_sample_n(size = 50, reps = 20, replace = F)

ci_n50_reps20 <-  samples_n50_reps20 %>%
  
        summarise(p_hat = mean(blue), 
                  se = sqrt(p_hat*(1-p_hat)/50),  ### need to modify for proper sample size
                  me = qnorm(0.95) * se,
                  lower = p_hat - me,
                  upper = p_hat + me)

ci_n50_reps20 <- ci_n50_reps20 %>%
  mutate(capture_p = ifelse(lower < p_blue_population & upper > p_blue_population, "yes", "no"))

ci_n50_reps20_data <- gather(ci_n50_reps20, type, bound, lower:upper)

ci_n50_reps20_data %>% 

  ggplot(aes(y = replicate, x = bound, group = replicate, color=capture_p)) +
    geom_point(size = 2)+
    geom_line(color="forestgreen")+
    geom_vline(xintercept = 0.1904, color = "steelblue")+
    scale_x_continuous(limits = c(0.00, 0.50))+
    theme(legend.position = "none")

```






























