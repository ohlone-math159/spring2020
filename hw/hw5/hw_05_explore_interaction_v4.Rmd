---
title: "hw05_explore_relationships_sample_report"
output:
  html_document:
    theme: sandstone
    highlight: tango
    toc: yes
    toc_float: yes
    #css: ~/R/spring2020/data/sandstone.css
    tables: yes
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, messages=F, warnings=F)
```

```{r library packages, results='hide', warnings=F, message=FALSE}
library(dplyr)
library(ggplot2)
library(janitor)
library(purrr)
library(kableExtra)
library(ggmosaic)  ###Note: you will need to run the following in your console.###  ###devtools::install_github("haleyjeppson/ggmosaic")###
library(scales)
```

```{r set ggplot2 parameters, echo=F}
theme_update(plot.title = element_text(hjust = 0.5))
```

```{r load data}
load("~/R/spring2020/data/demo_addhealth_clean.Rdata")
```
 

# Variables of Interest

Original Variable  |   New Variable  |    Description
-------------------|-----------------|------------------
BIO_SEX4 | gender | subject's gender
H4ED2 | education | Highest level of education completed (5 levels)
H4DA11 | vigorous_activity | In the past 24 hours, have you participated in vigorous physical activity long enough to work up a sweat, get your heart thumping, or get out of breath?
H4LM19 | hrs_worked_week | How many hours a week (do/did) you usually work at this job?

# Association between categorical variables

## Vigorous Activity Proportion by Education Attainment

Subject were asked "*In the past 24 hours, have you participated in vigorous physical activity long enough to work up a sweat, get your heart thumping, or get out of breath*?  First we will break this question down by education level, then by gender.  Then we will group by gender and compare response by education level.

```{r table sweat/educ}
demo %>%
  filter(vigorous_activity %in% c("yes","no"))  %>% 
  droplevels() %>% 
  filter(!education =="don't know") %>%
  droplevels() %>% 
  tabyl( education, vigorous_activity) %>%
  adorn_totals(c("row")) %>% 
  adorn_percentages("row") %>% 
  adorn_pct_formatting(digits=0) %>% 
  kable(booktabs = TRUE) %>%
  kable_styling(full_width = T, 
                position="left") %>% 
  add_header_above(c("","vigorous activity"=2))
```

```{r bar graph sweat/educ}
demo %>%
  filter(vigorous_activity %in% c("yes","no"))  %>% 
  droplevels() %>% 
  filter(!education =="don't know") %>% 
  droplevels() %>% 
  ggplot(aes(x=education, fill=vigorous_activity)) +
  geom_bar(position = position_fill(reverse = TRUE), width=.6) +
  scale_fill_brewer(palette="Dark2") +
  #facet_wrap(~gender, ncol=1) + ##removing wrapping by gender##
  #ggtitle("Vigorous Activity (past 24h) breakdown by Education Level ") +
  scale_y_continuous(labels=percent) +
  coord_flip()
```

```{r table sweat/gender}
demo %>%
  filter(vigorous_activity %in% c("yes","no"))  %>% 
  droplevels() %>% 
  #filter(!education =="don't know") %>% 
  #droplevels() %>% 
  tabyl(gender, vigorous_activity) %>% 
  adorn_totals(c("row")) %>% 
  adorn_percentages("row") %>% 
  adorn_pct_formatting(digits=0) %>% 
  #adorn_ns()  
  kable(booktabs = TRUE) %>%
  kable_styling(full_width = T, 
                position="left") %>% 
  add_header_above(c("","vigorous activity"=2))
  
```

```{r bar graph sweat/gender}
demo %>%
  filter(vigorous_activity %in% c("yes","no"))  %>% 
  droplevels() %>% 
  ggplot(aes(x=gender, fill=vigorous_activity, group=vigorous_activity)) +
  geom_bar(position = position_fill(reverse = TRUE), width=.66) +
  scale_fill_brewer(palette="Dark2") +
  #facet_wrap(~gender, ncol=1) + ##removing wrapping by gender##
  #ggtitle("Vigorous Activity (past 24h) breakdown by Gender ") +
  scale_y_continuous(labels=percent) +
  coord_flip()
```

```{r table sweat - edu - males} 
demo %>% 
  filter(gender =="male") %>% 
  droplevels() %>% 
  filter(vigorous_activity %in% c("yes","no"))  %>% 
  droplevels() %>% 
  filter(!education =="don't know") %>% 
  droplevels() %>% 
  tabyl(education, vigorous_activity) %>% 
  adorn_totals(c("row")) %>% 
  adorn_percentages("row") %>% 
  adorn_pct_formatting(digits=0) %>% 
  #adorn_ns()  
  kable(booktabs = TRUE) %>%
  kable_styling(full_width = T, 
                position="left") %>%
  add_header_above(c("MALE RESPONSES \n \n vigorous activity"=3))

```



```{r table sweat - educ - female}
demo %>% 
  filter(gender =="female") %>% 
  droplevels() %>% 
  filter(vigorous_activity %in% c("yes","no"))  %>% 
  droplevels() %>% 
  filter(!education =="don't know") %>% 
  droplevels() %>% 
  tabyl(education, vigorous_activity) %>% 
  adorn_totals(c("row")) %>% 
  adorn_percentages("row") %>% 
  adorn_pct_formatting(digits=0) %>% 
  #adorn_ns()  
  kable(booktabs = TRUE) %>%
  kable_styling(full_width = T, 
                position="left") %>% 
  add_header_above(c("FEMALE RESPONSES \n \n vigorous activity"=3))

```

```{r bar plot}
demo %>%
  filter(vigorous_activity %in% c("yes","no"))  %>% 
  droplevels() %>% 
  filter(!education =="don't know") %>% 
  droplevels() %>% 
  ggplot(aes(x=education, fill=vigorous_activity, group=vigorous_activity)) +
  geom_bar(position = position_fill(reverse = TRUE), width=.6) +
  scale_fill_brewer(palette="Dark2") +
  facet_wrap(~gender, ncol=1) +
  ggtitle("Engaging in a Vigorous Activity (24h) comparison with Education Level ") +
  scale_y_continuous(labels=percent) +
  coord_flip()
```

```{r mosiac plot, eval=F}
demo %>%
  filter(vigorous_activity %in% c("yes","no"))  %>% 
  droplevels() %>% 
  filter(!education =="don't know") %>% 
  droplevels() %>% 
  ggplot() +
    geom_mosaic(aes( x = product( vigorous_activity ,education), 
                     fill=vigorous_activity), 
                na.rm=TRUE)+
    scale_fill_brewer(palette="Dark2") +
    ggtitle("Engaging in a Vigorous Activity (24h) comparison with Education Level ") +
  coord_flip()+
  facet_wrap(~gender, ncol=1)
```

### Narrative Summary

<div id="narrative">
The percent of those who engaging in vigorous activity in the past 24 hours is decreasing as education level increase, showing a potential association.  Is this trend also observed for both genders?
</div>


# Association between numerical and categorical variables

## Analysis of Relationship between Educational Level anfd Usual Hours Worked Per Week 

### Summary Statistics 
```{r summary table num-cat 1}
demo %>% 
  filter(!education =="don't know") %>% 
  droplevels() %>% 
  filter(hrs_work_week < 121) %>% 
  group_by(education) %>% 
  summarize(n = n(),
            min = min(hrs_work_week),
            q1 = quantile(hrs_work_week, probs=0.25),
            median = median(hrs_work_week),
            mean = mean(hrs_work_week),
            q3 = quantile(hrs_work_week, probs=0.75),
            max = max(hrs_work_week),
            sd = sd(hrs_work_week)) %>% 
  kable() %>% 
    kable_styling(full_width = T, 
                  position="left")   %>% 
      add_header_above(c("hours worked summary statistics "= 9))
```

### Visualization (Use the best option)

```{r histogram hours/ed, eval=FALSE}
demo %>% 
  filter(!education =="don't know") %>% 
  droplevels() %>% 
  filter(hrs_work_week < 121) %>% 
  ggplot(aes(hrs_work_week))+

    geom_histogram(aes(y=..density.., 
                     fill=education), 
                 color="white", 
                 binwidth = 5) +
      scale_fill_brewer(palette="Dark2") +
    facet_wrap(~education, 
               ncol=1)
```

```{r boxplot hours/educ}
demo %>% 
  filter(!education =="don't know") %>% 
  droplevels() %>% 
  filter(hrs_work_week < 121) %>% 
  ggplot(aes(y=hrs_work_week, x=education))+
    scale_fill_brewer(palette="Dark2") +
    geom_boxplot(aes(fill=education))+  # potentially add , outlier.shape = NA
    coord_flip()  # might be nice to re-scale axis 
  
```

### Violin Plots
```{r violin plot, eval=FALSE}
demo %>% 
  filter(!education =="don't know") %>% 
  droplevels() %>% 
  filter(hrs_work_week < 121) %>% 
  ggplot(aes(y=hrs_work_week, x=education)) +
    geom_violin(aes(fill=education), adjust=2) + # potentially add , outlier.shape = NA
    scale_fill_brewer(palette="Dark2") +
    coord_flip()  # might be nice to re-scale axis 
  
```



would like to fix for next semester

Cant get this to work 3 way table with tabyl

Error in class(dat[[1]]) <- new_class : adding class "factor" to an invalid object
```{r, eval =F}
demo %>%
#  filter(vigorous_activity %in% c("yes","no"))  %>% 
#  droplevels() %>% 
#  filter(!education =="don't know") %>% 
 # droplevels() %>% 
  tabyl(education, vigorous_activity, gender)
```



